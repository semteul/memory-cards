<!-- Modal for editing cards -->
<div class="modal fade" id="cardModal" tabindex="-1" role="dialog" aria-labelledby="cardModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">카드 수정</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="card-form">
          <div class="form-group">
            <label for="card-question">외울 것</label>
            <input type="text" class="form-control" id="card-question" placeholder="외울 것을 입력하세요">
          </div>
          <div class="form-group">
            <label for="card-answer">숨길 것</label>
            <input type="text" class="form-control" id="card-answer" placeholder="숨길 것을 입력하세요">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
        <button type="button" id="save-card-btn" class="btn btn-primary">저장</button>
        <!-- Delete button added -->
        <button type="button" id="delete-card-btn" class="btn btn-danger">삭제하기</button>
      </div>
    </div>
  </div>
</div>

<script>
  let decks = JSON.parse(localStorage.getItem('memoryDecks')) || [];
  let currentDeckIndex = localStorage.getItem('currentDeckIndex');
  let currentDeck = decks[currentDeckIndex];
  let currentIndex = 0;
  let isEditing = false;
  let editIndex = null;
  let originalOrder = [...currentDeck.cards]; // 원래 순서를 저장

  // Set deck name
  $('#deck-name').text(currentDeck.name);

  // Function to render the card list
  function renderCardList() {
    $('#card-list').empty();
    currentDeck.cards.forEach((card, index) => {
      $('#card-list').append(`
        <tr>
          <td class='mytext'>${card.question}</td>
          <td class="mytext answer-cell hidden">${card.answer}</td>
          <td>
            <button class="btn btn-sm btn-secondary toggle-answer-btn" data-index="${index}">보이기</button>
          </td>
          <td>
            <button class="btn btn-sm btn-warning edit-card-btn" data-index="${index}">수정</button>
          </td>
        </tr>
      `);
    });
  }

  // Toggle visibility of the answer
  $(document).on('click', '.toggle-answer-btn', function() {
    const index = $(this).data('index');
    const $answerCell = $(this).closest('tr').find('.answer-cell');
    if ($answerCell.hasClass('hidden')) {
      $answerCell.removeClass('hidden');
      $(this).text('숨기기');
    } else {
      $answerCell.addClass('hidden');
      $(this).text('보이기');
    }
  });

  // Open modal for editing the card
  $(document).on('click', '.edit-card-btn', function() {
    editIndex = $(this).data('index');
    const card = currentDeck.cards[editIndex];
    $('#card-question').val(card.question);
    $('#card-answer').val(card.answer);
    $('#cardModal').modal('show');
  });

  // Save the edited card
  $('#save-card-btn').click(function() {
    const question = $('#card-question').val();
    const answer = $('#card-answer').val();

    if (question && answer && editIndex !== null) {
      currentDeck.cards[editIndex].question = question;
      currentDeck.cards[editIndex].answer = answer;
      localStorage.setItem('memoryDecks', JSON.stringify(decks));
      $('#cardModal').modal('hide');
      renderCardList();
    }
  });

  // Delete the selected card
  $('#delete-card-btn').click(function() {
    if (editIndex !== null) {
      currentDeck.cards.splice(editIndex, 1); // Remove the selected card
      localStorage.setItem('memoryDecks', JSON.stringify(decks));
      $('#cardModal').modal('hide'); // Close the modal
      renderCardList(); // Re-render the card list
    }
  });

  // Add a new card
  $('#add-card-btn').click(function() {
    $('#card-form')[0].reset();
    isEditing = false;
    $('#cardModal').modal('show');
  });

  // Save the new card
  $('#save-card-btn').click(function() {
    const question = $('#card-question').val();
    const answer = $('#card-answer').val();

    if (question && answer && !isEditing) {
      currentDeck.cards.push({ question, answer });
      localStorage.setItem('memoryDecks', JSON.stringify(decks));
      $('#cardModal').modal('hide');
      renderCardList();
    }
  });

  // Shuffle the card order randomly
  $('#random-order-btn').click(function() {
    currentDeck.cards = currentDeck.cards.sort(() => Math.random() - 0.5);
    renderCardList();
  });

  // Sort the cards in original order (by registration)
  $('#original-order-btn').click(function() {
    currentDeck.cards = [...originalOrder];  // 원래 저장된 순서로 복구
    renderCardList();
  });

  // Initial render
  renderCardList();
</script>
